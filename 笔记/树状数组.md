[Contest1188 - 算法提高课—高级数据结构—树状数组 - ZJHUOJ](http://172.20.8.83/contest.php?cid=1188)





## 线性序列

![img](http://172.20.8.83/upload/172.20.8.83/20241016/20241016185155_37293.png)

## 树状数组

- 树状数组（Binary Indexed Tree, Fenwick Tree），是一种数据结构，可用于更新及前缀和、区间和等问题，且效率高，一般时间复杂度为 O(log⁡n)*O*(log*n*)。

#### 统计思维



![img](http://172.20.8.83/upload/172.20.8.83/20241016/20241016182557_19745.png)



#### 差分并线性化

- a[i]*a*[*i*]：存储了以 i*i* 为右边界、长度为 lowbit(i)*l**o**w**b**i**t*(*i*) 的区间的统计信息
- 虽然是线性的，但逻辑上有父子关系
- 父、子间的层级差是不等的。
- a5*a*5 的父节点是 a6*a*6，是第二级；原因是：5+1是 2121 的倍数
- a15*a*15 的父节点是 a16*a*16，是第四级。原因是：15+1是 2424 的倍数
- a6*a*6 的父节点是 a8*a*8，是第三级。原因是：6+2是 2323 的倍数，并不是 2222 的倍数

![img](http://172.20.8.83/upload/172.20.8.83/20241016/20241016182840_85027.png)

## 树状区间 —— 倍增

- 是一种按二进制分拆前缀区间的思想
- 例如 [1,13][1,13]，(13)10=(1101)2(13)10=(1101)2，则从左向右分拆为 (0，8]、(8，12]、(12，13](0，8]、(8，12]、(12，13] 三个区间，各区间长度为 8、4、1，分别对应二进制中的 1。
- 位置 p*p* 的倍增区间：(p−lowbit(p)，p](*p*−*l**o**w**b**i**t*(*p*)，*p*]

![img](http://172.20.8.83/upload/172.20.8.83/20241016/20241016185932_19338.png)

## 遍历兄弟区间

- 遍历的序：一般是从右向左
- [1，r][1，*r*] 的遍历过程就是拆分过程。各区间的右边界的遍历为：while(r>0)*w**h**i**l**e*(*r*>0) r*r* −=lowbit(r);−=*l**o**w**b**i**t*(*r*);
- 例如：[1,13][1,13] 的分拆过程是 (12,13]、(8,12]、(0,8]，其中，12 = 13- lowbit(13)，8 = 12- lowbit(12)，0 = 8- lowbit(8)
- 时间复杂度为 O(log⁡n)*O*(log*n*)

## 遍历父区间

#### P的父区间

- 设 P=45=(101101)2*P*=45=(101101)2，p*p* 的树状区间是 (44,45](44,45]，对应的线性元素是 a45*a*45，它的父区间是 (44,46](44,46]，对应的线性元素是 a46*a*46
- 设 P=46=(101110)2*P*=46=(101110)2，p*p* 的树状区间是 (44,46](44,46]，对应的线性元素是 a46*a*46，它的父区间是 (32,48](32,48]，对应的线性元素是 a48*a*48
- 设 P=48=(110000)2*P*=48=(110000)2，p*p* 的树状区间是 (32,48](32,48]，对应的线性元素是 a48*a*48，它的父区间是 (0,64](0,64]，对应的线性元素是 a64*a*64

#### 遍历P的父区间

- while(r≤n)*w**h**i**l**e*(*r*≤*n*) r*r* +=lowbit(r);+=*l**o**w**b**i**t*(*r*);
- 时间复杂度为 O(log⁡n)*O*(log*n*)

#### 单点更新

- 把更新传导到各个祖先节点

## 求解类型

- 单点修改+区间查询
- 区间修改+单点查询
- 区间修改+区间查询