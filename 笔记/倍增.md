[Contest1210 - 算法提高课—基础算法—RMQ - ZJHUOJ](http://172.20.8.83/contest.php?cid=1210)



## 倍增

- 1、2、4、8、16、32、⋯、2k、⋯1、2、4、8、16、32、⋯、2*k*、⋯
- ⋯、2k、⋯、32、16、8、4、2、1⋯、2*k*、⋯、32、16、8、4、2、1

## 序列的倍增区间

- 设序列为 a1,a2,a3,⋯,a27*a*1,*a*2,*a*3,⋯,*a*27

#### 起点 11 的倍增区间

- [1,1]、[1,2]、[1,4]、[1,8]、[1,16][1,1]、[1,2]、[1,4]、[1,8]、[1,16]
- 数量：1+lg⁡(n−0)1+lg(*n*−0)
- 另一种表示 (i,j)(*i*,*j*)：区间的起点是 i*i*，长度为2j2*j*。所以，可表示为 (1,0)、(1,1)、(1,2)、(1,3)、(1,4)(1,0)、(1,1)、(1,2)、(1,3)、(1,4)
- a17、⋯、a27*a*17、⋯、*a*27 不属于任何以 1 为起点的倍增区间

#### 起点 22 的倍增区间

- [2,2]、[2,3]、[2,5]、[2,9]、[2,17][2,2]、[2,3]、[2,5]、[2,9]、[2,17]
- 数量：1+lg⁡(n−1)1+lg(*n*−1)
- 另一种表示：(2,0)、(2,1)、(2,2)、(2,3)、(2,4)(2,0)、(2,1)、(2,2)、(2,3)、(2,4)
- a1、a18、⋯、a27*a*1、*a*18、⋯、*a*27 不属于任何以 2 为起点的倍增区间

#### 起点 2727 的倍增区间

- [27,27][27,27]
- 数量：1+lg⁡(n−26)1+lg(*n*−26)
- 另一种表示：(27,0)(27,0)
- a1、⋯、a26*a*1、⋯、*a*26 不属于任何以 27 为起点的倍增区间

#### 所有起点的倍增区间

- 二维 ST*S**T* 表
- st[i][j]*s**t*[*i*][*j*]：起点 i*i* 长度为 2j2*j* 的区间
- 区间关系： st[i][j]=st[i][j−1]+st[i+(1<<j−1))][j−1]*s**t*[*i*][*j*]=*s**t*[*i*][*j*−1]+*s**t*[*i*+(1<<*j*−1))][*j*−1]
- 空间复杂度：O(n⋅log⁡n)*O*(*n*⋅log*n*)，n*n* 行，log⁡nlog*n* 列
- 一般情况下，时间复杂度：O(n⋅log⁡n)*O*(*n*⋅log*n*)

## RMQ问题

- RMQ：range max/min question，区间最值问题

#### ST*S**T* 表预处理

- 定义：st[i][j]=max(ai,ai+1,⋯,ai+(1<<j)−1)*s**t*[*i*][*j*]=*m**a**x*(*a**i*,*a**i*+1,⋯,*a**i*+(1<<*j*)−1)，即st[i][j]*s**t*[*i*][*j*] 是起点为 i*i* 长度为 2j2*j* 的区间内大最大值
- st[i][0]=ai*s**t*[*i*][0]=*a**i*
- 根据区间关系，st[i][j]=max(st[i][j−1],st[i+(1<<j−1))][j−1])*s**t*[*i*][*j*]=*m**a**x*(*s**t*[*i*][*j*−1],*s**t*[*i*+(1<<*j*−1))][*j*−1])，按列递推，即外层是列 j*j*，内层循环是行 i*i*
- 第 0 行无效，但第 0 列是有效的
- 枚举行 i*i* 时，要注意行 i*i* 的上限， for(int*f**o**r*(*i**n**t* i=1;*i*=1; i+(1<<j)−1≤n;*i*+(1<<*j*)−1≤*n*; ++i)++*i*)

![img](http://172.20.8.83/upload/172.20.8.83/20241015/20241015165627_84206.jpg)

#### 重叠倍增区间

- 一个一般的区间 [l,r][*l*,*r*]，可以拆解为 22 个可能重叠的尽可能大的倍增区间。例如 [3,16][3,16] 拆解为两个重叠的长度为 8 的区间，即 [3,10][3,10] 和 [9,16][9,16]，后者是前者平移 r−(l+(1<<3)−1)*r*−(*l*+(1<<3)−1)

#### 任意区间的最值

- 根据给定的区间 [l,r][*l*,*r*] 得到区间长度 len=r−l+1*l**e**n*=*r*−*l*+1，求解出 k*k* 值； 值本质上是 len*l**e**n* 的二进制表示中的最高位 1 的位置。
- 然后根据 st*s**t* 表 求解区间最大值 ans=max(st[l][k],st[r−(1<<k)+1][k]*a**n**s*=*m**a**x*(*s**t*[*l*][*k*],*s**t*[*r*−(1<<*k*)+1][*k*]
- 注意第二个区间的左边界的计算方法：r−(1<<k)+1*r*−(1<<*k*)+1，括号不能省

## 特别注意

- 预处理中，构造st表时，分解区间；任意区间求最值时，也需要分解区间
- 两次左边界的计算方式是有区别的